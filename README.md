# å¼ºæ™ºæ•™åŠ¡ç³»ç»Ÿè‡ªåŠ¨åŒ–å·¥å…·

å¼ºæ™ºæ•™åŠ¡ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–ç™»å½•å’Œå®Œæ•´APIè®¿é—®å·¥å…·ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### å­¦ç”Ÿç«¯åŠŸèƒ½
- âœ… **è‡ªåŠ¨ç™»å½•** - æ”¯æŒéªŒè¯ç è‡ªåŠ¨è¯†åˆ«å’Œç™»å½•é‡è¯•æœºåˆ¶
- âœ… **æ™ºèƒ½ä¼šè¯ç®¡ç†** - è‡ªåŠ¨ä¼šè¯æŒä¹…åŒ–ã€è¿‡æœŸæ£€æµ‹å’Œé‡æ–°ç™»å½•
- âœ… **å®Œæ•´APIæ¥å£** - æ”¯æŒä¸ªäººä¿¡æ¯ã€è¯¾ç¨‹è¡¨ã€æˆç»©ã€è€ƒè¯•å®‰æ’ç­‰åŠŸèƒ½
- âœ… **æ™ºèƒ½è¯¾è¡¨è§£æ** - æ”¯æŒå¤æ‚å‘¨æ¬¡æ ¼å¼è§£æï¼ˆå¦‚"3-5,8,10-11,13,16-17"ï¼‰
- âœ… **è¯¾ç¨‹æ•°æ®æ‹†åˆ†** - è‡ªåŠ¨å°†è¯¾ç¨‹æŒ‰å‘¨æ¬¡æ‹†åˆ†ä¸ºç‹¬ç«‹çš„è¯¾ç¨‹å•å…ƒ
- âœ… **éªŒè¯ç è¯†åˆ«** - åŸºäºddddocrçš„é«˜å‡†ç¡®ç‡éªŒè¯ç è¯†åˆ«
- âœ… **é”™è¯¯é‡è¯•** - æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œæé«˜ç™»å½•æˆåŠŸç‡
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

### ç®¡ç†ç«¯åŠŸèƒ½ï¼ˆæ–°å¢ï¼‰
- âœ… **ç®¡ç†ç«¯ç™»å½•** - æ”¯æŒæ•™åŠ¡ç³»ç»Ÿç®¡ç†ç«¯ç™»å½•å’Œä¼šè¯ç»´æŠ¤
- âœ… **å­¦ç±ç®¡ç†API** - å­¦ç”ŸåŸºæœ¬ä¿¡æ¯æŸ¥è¯¢ã€æ‰¹é‡æ•°æ®å¯¼å‡º
- âœ… **æ•°æ®æå–** - æ”¯æŒåˆ†é¡µæ•°æ®è‡ªåŠ¨æå–å’Œè§£æ
- âœ… **å¤šæ ¼å¼å¯¼å‡º** - JSONã€CSVç­‰å¤šç§æ•°æ®æ ¼å¼æ”¯æŒ
- âœ… **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ã€æˆç»©ç­‰æ•°æ®
- âœ… **APIæ–‡æ¡£** - å®Œæ•´çš„ç®¡ç†ç«¯APIæ¥å£æ–‡æ¡£

## ğŸ§© æ ¸å¿ƒæ¨¡å—

### SessionManager ä¼šè¯ç®¡ç†å™¨
- è‡ªåŠ¨ä¼šè¯æŒä¹…åŒ–ï¼ˆä¿å­˜åˆ° `session.json`ï¼‰
- ä¼šè¯è¿‡æœŸæ£€æµ‹å’Œè‡ªåŠ¨é‡æ–°ç™»å½•
- ç»Ÿä¸€çš„HTTPè¯·æ±‚æ¥å£
- æ”¯æŒä¼šè¯è¶…æ—¶é…ç½®

### JwglAPI æ•™åŠ¡APIæ¥å£
- è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯
- è·å–è¯¾ç¨‹è¡¨ä¿¡æ¯ï¼ˆæ”¯æŒå¤æ‚å‘¨æ¬¡æ ¼å¼è§£æï¼‰
- è·å–æˆç»©ä¿¡æ¯ï¼ˆæ”¯æŒå­¦æœŸç­›é€‰ï¼‰
- è·å–è€ƒè¯•å®‰æ’
- è·å–å¯ç”¨å­¦æœŸåˆ—è¡¨
- è¿æ¥çŠ¶æ€æµ‹è¯•
- è¯¾ç¨‹æ•°æ®æ‹†åˆ†ï¼ˆæŒ‰å‘¨æ¬¡ç”Ÿæˆè¯¾ç¨‹å•å…ƒï¼‰

### LoginManager ç™»å½•ç®¡ç†å™¨
- éªŒè¯ç è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç†
- ç™»å½•é‡è¯•æœºåˆ¶
- ä¼šè¯Cookieç®¡ç†

### CaptchaSolver éªŒè¯ç è§£å†³å™¨
- ddddocr OCRè¯†åˆ«
- å›¾åƒé¢„å¤„ç†
- æ‰‹åŠ¨è¾“å…¥å¤‡é€‰æ–¹æ¡ˆ

### ç®¡ç†ç«¯æ¨¡å—ï¼ˆadmin/ï¼‰
- **AdminLogin** - ç®¡ç†ç«¯ç™»å½•å’Œä¼šè¯ç»´æŠ¤
- **student_data_fetch** - å­¦ç”Ÿæ•°æ®æ¥å£è°ƒç”¨
- **parse_student_table** - HTMLè¡¨æ ¼æ•°æ®è§£æï¼ˆæ”¯æŒ60+å­—æ®µï¼‰
- **extract_all_pages** - åˆ†é¡µæ•°æ®è‡ªåŠ¨æå–
- **æ•°æ®å¯¼å‡º** - æ”¯æŒJSONã€CSVå¤šç§æ ¼å¼

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- `requests` - HTTPè¯·æ±‚å¤„ç†
- `beautifulsoup4` - HTMLè§£æ
- `lxml` - XML/HTMLè§£æå™¨
- `ddddocr` - éªŒè¯ç è¯†åˆ«
- `Pillow` - å›¾åƒå¤„ç†
- `pandas` - æ•°æ®å¤„ç†å’ŒCSVå¯¼å‡º

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### æ¨èç”¨æ³•ï¼šä½¿ç”¨SessionManager

```python
from src.session_manager import SessionManager
from src.jwgl_api import JwglAPI

# 1. åˆ›å»ºä¼šè¯ç®¡ç†å™¨
session_manager = SessionManager(
    base_url="http://58.20.60.39:8099",
    session_file="session.json",
    session_timeout=1800  # 30åˆ†é’Ÿè¶…æ—¶
)

# 2. è®¾ç½®ç™»å½•å‡­æ®ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
session_manager.set_login_credentials("ä½ çš„å­¦å·", "ä½ çš„å¯†ç ")

# 3. ç¡®ä¿ç™»å½•çŠ¶æ€ï¼ˆè‡ªåŠ¨å¤„ç†ä¼šè¯åŠ è½½/ç™»å½•ï¼‰
if session_manager.ensure_logged_in():
    print("ç™»å½•æˆåŠŸï¼")
    
    # 4. åˆ›å»ºAPIå®¢æˆ·ç«¯
    api = JwglAPI(session=session_manager)
    
    # 5. ä½¿ç”¨APIè·å–ä¿¡æ¯
    user_info = api.get_user_info()        # è·å–ä¸ªäººä¿¡æ¯
    schedule = api.get_schedule()          # è·å–è¯¾ç¨‹è¡¨ï¼ˆæ‹†åˆ†ä¸ºè¯¾ç¨‹å•å…ƒï¼‰
    grades = api.get_grades()              # è·å–æˆç»©
    exams = api.get_exam_schedule()        # è·å–è€ƒè¯•å®‰æ’
    
    print(f"ç”¨æˆ·ä¿¡æ¯: {user_info}")
    print(f"è¯¾ç¨‹å•å…ƒæ•°é‡: {len(schedule)}")  # schedule ç°åœ¨è¿”å›è¯¾ç¨‹å•å…ƒåˆ—è¡¨
    
    # ç¤ºä¾‹ï¼šæŸ¥çœ‹ç¬¬5å‘¨çš„è¯¾ç¨‹å®‰æ’
    week_5_courses = [unit for unit in schedule if unit['week'] == 5]
    print(f"ç¬¬5å‘¨è¯¾ç¨‹æ•°é‡: {len(week_5_courses)}")
else:
    print("ç™»å½•å¤±è´¥")
```

### ä¼šè¯å¤ç”¨ç¤ºä¾‹

```python
# ç¬¬äºŒæ¬¡è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½ä¿å­˜çš„ä¼šè¯
sm = SessionManager()
if sm.ensure_logged_in():  # ä¼šå°è¯•åŠ è½½ä¿å­˜çš„ä¼šè¯
    print("ä½¿ç”¨å·²ä¿å­˜çš„ä¼šè¯ï¼Œæ— éœ€é‡æ–°ç™»å½•")
    api = JwglAPI(session=sm)
    # ç›´æ¥ä½¿ç”¨API...
```

### ä¼ ç»Ÿç™»å½•æ–¹å¼

```python
from src.login_manager import LoginManager

# ç›´æ¥ä½¿ç”¨LoginManager
lm = LoginManager("http://58.20.60.39:8099")
result = lm.login(username="ä½ çš„å­¦å·", password="ä½ çš„å¯†ç ", auto_captcha=True)

if result['success']:
    print("ç™»å½•æˆåŠŸï¼")
    # ä½¿ç”¨ lm.session è¿›è¡Œåç»­è¯·æ±‚
else:
    print(f"ç™»å½•å¤±è´¥: {result['message']}")
```

### ç®¡ç†ç«¯ä½¿ç”¨ç¤ºä¾‹

#### ç®¡ç†ç«¯ç™»å½•

```python
from admin.admin_login import AdminLogin

# åˆ›å»ºç®¡ç†ç«¯ç™»å½•å®ä¾‹
admin = AdminLogin()
admin.login(username="admin_user", password="admin_pass")
```

#### æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯

```python
from admin.student_data_fetch import fetch_student_data

# æŸ¥è¯¢ä¿¡æ¯å·¥ç¨‹å­¦é™¢ 2024å¹´å…¥å­¦çš„å­¦ç”Ÿ
result = fetch_student_data(
    department_code="21",  # ä¿¡æ¯å·¥ç¨‹å­¦é™¢
    entry_year="2024",
    page=1
)

# è§£æè¿”å›çš„HTMLæ•°æ®
from admin.parse_student_table import parse_student_table
students = parse_student_table(result['html'])
print(f"æŸ¥è¯¢åˆ° {len(students)} åå­¦ç”Ÿ")
```

#### æ‰¹é‡å¯¼å‡ºæ•°æ®

```python
from admin.extract_all_pages import extract_all_student_pages

# æå–æ‰€æœ‰åˆ†é¡µæ•°æ®
extract_all_student_pages(
    department_code="21",
    entry_year="2024",
    total_pages=2,
    output_format="both"  # åŒæ—¶è¾“å‡ºJSONå’ŒCSV
)
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
qiangzhi-jwgl/
â”œâ”€â”€ src/                      # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ login_manager.py     # ç™»å½•ç®¡ç†å™¨
â”‚   â”œâ”€â”€ captcha_solver.py    # éªŒè¯ç è¯†åˆ«
â”‚   â”œâ”€â”€ jwgl_api.py          # æ•™åŠ¡ç³»ç»ŸAPI
â”‚   â””â”€â”€ session_manager.py   # ä¼šè¯ç®¡ç†
â”œâ”€â”€ scripts/                 # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ test_session_manager.py  # SessionManageræµ‹è¯•
â”œâ”€â”€ admin/                   # ç®¡ç†ç«¯åŠŸèƒ½
â”‚   â”œâ”€â”€ admin_login.py      # ç®¡ç†ç«¯ç™»å½•
â”‚   â”œâ”€â”€ student_data_fetch.py  # å­¦ç”Ÿæ•°æ®æå–
â”‚   â”œâ”€â”€ parse_student_table.py # è¡¨æ ¼æ•°æ®è§£æ
â”‚   â””â”€â”€ extract_all_pages.py   # åˆ†é¡µæ•°æ®æå–
â”œâ”€â”€ output/                  # è¾“å‡ºæ•°æ®
â”‚   â”œâ”€â”€ students_page_*.json # JSONæ ¼å¼æ•°æ®
â”‚   â””â”€â”€ students_page_*.csv  # CSVæ ¼å¼æ•°æ®
â”œâ”€â”€ docs/                    # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ å­¦ç”ŸåŸºæœ¬ä¿¡æ¯APIå®æµ‹.md
â”‚   â””â”€â”€ å­¦ç”ŸåŸºæœ¬ä¿¡æ¯ç®¡ç†APIå®Œæ•´ç‰ˆ.md
â”œâ”€â”€ temp/                    # ä¸´æ—¶æ–‡ä»¶
â”‚   â””â”€â”€ admin_session.json  # ç®¡ç†ç«¯ä¼šè¯
â”œâ”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ example_usage.py        # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ test_fixed.py           # åŸºæœ¬æµ‹è¯•
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## ğŸ§ª æµ‹è¯•è„šæœ¬

é¡¹ç›®æä¾›äº†å¤šä¸ªæµ‹è¯•è„šæœ¬ï¼š

```bash
# å®Œæ•´çš„SessionManageråŠŸèƒ½æµ‹è¯•
python scripts/test_session_manager.py

# åŸºæœ¬ç™»å½•åŠŸèƒ½æµ‹è¯•
python test_fixed.py

# ä½¿ç”¨ç¤ºä¾‹
python example_usage.py
```

## ğŸ“… è¯¾è¡¨è§£æåŠŸèƒ½

### æ™ºèƒ½å‘¨æ¬¡æ ¼å¼è§£æ

æ”¯æŒè§£æå„ç§å¤æ‚çš„å‘¨æ¬¡æ ¼å¼ï¼š

- **å•ä¸ªå‘¨æ¬¡**: `5`
- **è¿ç»­å‘¨æ¬¡**: `3-6`, `10-15`
- **å¤šä¸ªå‘¨æ¬¡**: `1,3,5,7`
- **å¤æ‚æ··åˆ**: `3-5,8,10-11,13,16-17`
- **ä¸è§„åˆ™æ ¼å¼**: `1-3å‘¨,5-7å‘¨`, `ç¬¬1,3,5å‘¨`

### è¯¾ç¨‹å•å…ƒæ‹†åˆ†

è‡ªåŠ¨å°†åŸå§‹è¯¾ç¨‹æ•°æ®æŒ‰å‘¨æ¬¡æ‹†åˆ†ä¸ºç‹¬ç«‹çš„è¯¾ç¨‹å•å…ƒï¼š

```python
# åŸå§‹æ•°æ®ï¼šä¸€é—¨è¯¾åœ¨å¤šä¸ªå‘¨æ¬¡
{
    "course_name": "é«˜ç­‰æ•°å­¦",
    "weeks": "3-5,8,10-11",
    "weekday": "å‘¨ä¸€",
    "periods": "1-2èŠ‚"
}

# æ‹†åˆ†åï¼š5ä¸ªç‹¬ç«‹çš„è¯¾ç¨‹å•å…ƒ
[
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 3, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"},
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 4, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"},
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 5, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"},
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 8, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"},
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 10, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"},
    {"course_name": "é«˜ç­‰æ•°å­¦", "week": 11, "weekday": "å‘¨ä¸€", "periods": "1-2èŠ‚", "weeks": "3-5,8,10-11"}
]
```

### æ•°æ®ç»“æ„

æ¯ä¸ªè¯¾ç¨‹å•å…ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```python
{
    "semester": "2024-2025-1",           # å­¦æœŸ
    "week": 5,                           # å…·ä½“å‘¨æ¬¡
    "weekday": "å‘¨ä¸€",                  # æ˜ŸæœŸ
    "time_slot_name": "ä¸€äºŒ",           # æ—¶é—´æ®µåç§°
    "periods": "1-2èŠ‚",                 # èŠ‚æ¬¡è¯¦æƒ…
    "course_name": "é«˜ç­‰æ•°å­¦",       # è¯¾ç¨‹å
    "teacher": "å¼ ä¸‰",                # æ•™å¸ˆ
    "classroom": "æ•™å­¦æ¥¼101",         # æ•™å®¤
    "weeks": "3-5,8,10-11"             # åŸå§‹å‘¨æ¬¡å­—ç¬¦ä¸²
}
```

## ğŸ’¯ ä¸»è¦ä¼˜åŠ¿

### ä¼šè¯æŒä¹…åŒ–
- ç™»å½•ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨
- è‡ªåŠ¨æ£€æµ‹ä¼šè¯è¿‡æœŸ
- è¿‡æœŸæ—¶è‡ªåŠ¨é‡æ–°ç™»å½•

### APIæ¥å£å®Œæ•´
- ä¸ªäººä¿¡æ¯æŸ¥è¯¢
- è¯¾ç¨‹è¡¨è·å–ï¼ˆæ”¯æŒå¤æ‚å‘¨æ¬¡è§£æï¼‰
- æˆç»©æŸ¥è¯¢ï¼ˆæ”¯æŒå­¦æœŸç­›é€‰ï¼‰
- è€ƒè¯•å®‰æ’æŸ¥è¯¢
- å­¦æœŸåˆ—è¡¨è·å–
- è¯¾ç¨‹æ•°æ®æ™ºèƒ½æ‹†åˆ†

### é«˜å¯é æ€§
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- é”™è¯¯æ¢å¤èƒ½åŠ›
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- å¼‚å¸¸å¤„ç†å®Œå–„

## âš™ï¸ é…ç½®é€‰é¡¹

### SessionManageré…ç½®

```python
session_manager = SessionManager(
    base_url="http://58.20.60.39:8099",  # æ•™åŠ¡ç³»ç»ŸURL
    session_file="session.json",          # ä¼šè¯ä¿å­˜æ–‡ä»¶
    session_timeout=1800                  # ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
)
```

### LoginManageré…ç½®

```python
result = login_manager.login(
    username="your_username",
    password="your_password",
    auto_captcha=True,      # è‡ªåŠ¨è¯†åˆ«éªŒè¯ç 
    max_retries=3          # æœ€å¤§é‡è¯•æ¬¡æ•°
)
```

## ğŸ”’ å®‰å…¨è¯´æ˜

- æœ¬å·¥å…·ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œä¾¿åˆ©ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”
- ç”¨æˆ·åå’Œå¯†ç ä»…åœ¨æœ¬åœ°ä½¿ç”¨ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨
- å»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œé¿å…ç¡¬ç¼–ç 

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©ã€‚å¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬å·¥å…·è€Œäº§ç”Ÿçš„ä»»ä½•åæœè´Ÿè´£ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues è”ç³»ã€‚